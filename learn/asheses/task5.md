## 第五章：Monad 101
 
1. 请简述 Monad 中的“延迟执行”概念。该机制如何优化共识与执行之间的关系？

2. 什么是乐观并行执行？其工作流程包含哪些关键步骤？

3. 在 Monad 架构中，如何通过并行执行仍保持交易的线性排序与状态一致性？

4. Monad 的共识机制monadBFT有哪些特点？它与传统 BFT 共识相比有何优势？

5. 为什么 Monad 采用“Optimistic Concurrency Control”？它在处理交易冲突方面是如何工作的？

1. ​​延迟执行（Deferred Execution）​​
​​概念​​：延迟执行是 Monad 的核心机制之一，其核心思想是将区块链的 ​​共识过程​​（交易排序的全局一致性）与 ​​交易执行​​（状态计算）解耦。节点先在共识层对交易顺序达成一致，再在异步执行层独立处理交易逻辑。

​​优化机制​​：

​​缩短出块时间​​：传统区块链（如以太坊）需要在共识过程中同步执行交易以生成状态根，而 Monad 只需确认交易排序即可完成共识，区块时间从秒级压缩至 1 秒。
​​提升吞吐量​​：共识与执行并行进行，节点在区块 N+1 的共识阶段可同时执行区块 N 的交易，充分利用网络带宽。
​​状态一致性保障​​：通过 ​​延迟默克尔根（Delayed Merkle Root）​​，Monad 在共识时包含前 D 个区块的状态根（D 为系统参数，通常为 3），确保节点最终执行结果一致，避免分叉。
2. ​​乐观并行执行（Optimistic Parallel Execution）​​
​​定义​​：Monad 通过假设交易间无冲突，并行执行多个交易，仅在冲突发生时重新执行相关交易，从而提升吞吐量。

​​关键步骤​​：

​​并行调度​​：将区块内交易划分为独立组，多核并行执行，无需预先声明依赖关系。
​​冲突检测​​：跟踪每笔交易的输入（如读取的账户状态），并与前序交易的输出对比，若不一致则标记为冲突。
​​按序重试​​：冲突交易按原始顺序重新执行，确保最终状态与顺序执行结果一致。
​​状态合并​​：所有交易的临时状态更新按区块顺序合并，保证全局一致性。
3. ​​并行执行与状态一致性保障​​
​​线性排序保留​​：

Monad 区块内交易仍保持 ​​线性顺序​​，与以太坊兼容，开发者无需修改代码即可迁移应用。
并行执行仅优化计算过程，最终状态按顺序合并，确保结果与顺序执行一致。
​​一致性机制​​：

​​静态代码分析​​：预判交易依赖关系，减少无效并行（如预测账户交互路径）。
​​乐观执行缓存​​：冲突交易重试时直接复用缓存数据（如签名恢复结果），降低计算开销。
​​状态回滚​​：若节点执行结果与延迟默克尔根不一致，自动回滚至前序状态并重新执行。
4. ​​MonadBFT 共识机制的特点与优势​​
​​特点​​：

​​基于 HotStuff 改进​​：采用两轮通信的拜占庭容错（BFT）算法，将传统三轮共识压缩为两轮，降低延迟。
​​抗尾部分叉​​：引入 ​​重新提议规则​​，确保诚实节点提议的区块不会被丢弃，避免网络停滞。
​​单轮投机最终性​​：区块获得 2/3 验证者投票后即视为“准最终”，下一轮确认后永久生效，缩短用户等待时间。
​​与传统 BFT 的优势​​：

​​吞吐量提升​​：流水线化流程支持每秒 10,000 笔交易（TPS），远超传统 BFT 的百级 TPS。
​​低硬件要求​​：验证节点仅需 32GB RAM，兼顾去中心化与高性能。
​​异步恢复​​：通过法定人数证书（QC）触发超时，而非固定计时器，动态适应网络延迟。
5. ​​乐观并发控制（Optimistic Concurrency Control, OCC）​​
​​采用原因​​：

​​减少锁开销​​：传统悲观锁会限制并行性，OCC 通过事后冲突检测最大化并发效率。
​​适配区块链特性​​：多数交易无状态冲突（如转账至不同地址），OCC 可显著降低重试率。
​​冲突处理流程​​：

​​并行执行阶段​​：所有交易默认无冲突，并行生成临时状态。
​​版本号追踪​​：记录交易读取的账户状态版本，提交时对比全局版本。
​​冲突解决​​：若版本不一致，按原始顺序重试交易，更新状态后提交。
​​缓存优化​​：冲突交易重试时优先读取内存缓存，避免重复磁盘 I/O