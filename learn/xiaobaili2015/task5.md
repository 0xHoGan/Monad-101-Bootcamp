## 第五章：Monad 101

1. 请简述 Monad 中的“延迟执行”概念。该机制如何优化共识与执行之间的关系？

```md
传统区块链通常在将交易打包进区块时，需要先执行这些交易，然后节点对包含了执行结果（例如状态根）的区块达成共识。这意味着执行过程直接影响共识的速度。

Monad 的延迟执行改变了这一流程：

先共识： 验证者节点首先就交易的顺序达成共识，确定一个区块中包含哪些交易以及它们的排列顺序。在这个阶段，交易的具体执行结果（例如状态改变、合约调用结果）尚未计算。

后执行： 一旦交易顺序得到共识确认并敲定，网络中的节点（包括验证者和全节点）才会独立地、异步地执行这些交易，计算最终的状态。
```

2. 什么是乐观并行执行？其工作流程包含哪些关键步骤？

```md
乐观并行执行采取“先执行，后验证”的策略。它大胆地并行运行交易，以期获得更高的吞吐量，并寄希望于冲突是少数情况。

1. 并行执行：

系统接收到一批已确定顺序的交易，将这些交易分配给多个执行单元同时执行，而不等待前一个交易完成。每个交易都基于当前状态的快照进行读取和计算。

2. 追踪读写集

在每个交易并行执行期间，会记录该交易所读取的状态（读集/输入）以及它打算修改的状态（写集/输出）。

3. 冲突检测

当并行执行的交易尝试提交其结果时，系统会检查是否存在冲突。

4. 验证与提交

如果一个交易的执行没有与其他（逻辑上先于它的）已提交或正在提交的交易发生冲突，那么它的执行结果被认为是有效的，其状态更改会被合并到全局状态中（按照它们在区块中的原始线性顺序）。

5. 冲突解决与重新执行

监测到冲入的交易会被回滚，使用最新的状态进行重新串行执行或以更受限的并行方式执行。
```

3. 在 Monad 架构中，如何通过并行执行仍保持交易的线性排序与状态一致性？

```md
通过 MonadBFT 共识机制，所有交易在一个区块内会被赋予一个明确的、不可改变的线性顺序。这个顺序是全局认同的，是并行执行的基础和最终参照。
```

4. Monad 的共识机制 monadBFT 有哪些特点？它与传统 BFT 共识相比有何优势？

```md
MonadBFT 的主要特点：

1. 流水线（Pipelining）设计：

MonadBFT 采用了流水线技术，允许共识的不同阶段（如提议、投票、确认）重叠进行，而不是严格串行。这类似于现代 CPU 中的指令流水线，可以显著提高共识的吞吐量和速度。

2. 单轮投机最终性（Single-Round Speculative Finality）：

在“快乐路径”（即没有领导者作恶或网络延迟的理想情况下），MonadBFT 可以在一轮通信内就达到投机最终性。这意味着区块可以非常快地被认为是“准最终”的，只有在极少数的恶意行为（如区块双花）发生时才可能被推翻，并且这种行为会被追责。

3. 乐观响应性（Optimistic Responsiveness）：

协议被设计为能够快速响应。即使在从故障领导者中恢复时，它也能保持乐观的响应性，轮次可以根据实际网络速度（例如，收到 2f+1 个验证者响应后）推进，而不是依赖固定的超时时间。

4. 线性消息和验证器复杂度（Happy Path）：

在快乐路径下，MonadBFT 的消息复杂度和验证器签名聚合等操作具有线性复杂度。这意味着随着验证者数量的增加，通信开销的增长是线性的，这对于支持更大规模的去中心化网络至关重要。

5. 抗尾部分叉 MEV（Tail-Forking MEV Resistance）：

一个显著的创新是 MonadBFT 内置了对特定形式的最大可提取价值（MEV）攻击——“尾部分叉”（Tail-Forking）的抵抗能力。尾部分叉是指恶意领导者分叉其前任区块，导致前任区块被废弃，从而剥夺前任的奖励，并允许恶意领导者重新排序、窃取或利用交易。MonadBFT 能有效减轻此类漏洞。

6. 问责制（Accountability）：

其投机机制经过精心设计，使得只有区块双花（equivocation）才能推翻投机执行，并且协议能够确保对这种恶意行为进行追责。
```

5. 为什么 Monad 采用“Optimistic Concurrency Control”？它在处理交易冲突方面是如何工作的？

```md
Monad 采用“乐观并发控制”（Optimistic Concurrency Control, OCC）的主要原因是为了最大限度地利用并行处理能力以提高交易吞吐量，同时保持与 EVM 语义的完全兼容性（即结果与串行执行一致）。

工作原理：
尽管是并行执行，但状态的最终确认和合并是严格按照交易在区块中的原始线性顺序进行的，在确认交易执行结果时可以检测冲突并回滚，步骤描述同问题 2⬆️⬆️⬆️。
```
